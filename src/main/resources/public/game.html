<!doctype html>
<html>
<head>
    <title>Game</title>
</head>

<body>
    <script type="text/javascript">
        //Establish the WebSocket connection and set up event handlers
        var webSocketAddress = "ws://" + location.host + "/play" + location.search;
        var webSocket = new WebSocket(webSocketAddress);
        var heartbeatTimer = 0;
        webSocket.onopen = onConnect;
        webSocket.onmessage = onMessage;
        webSocket.onclose = onClose;

        function onConnect() {
            console.log("Connected to websocket at " + webSocketAddress);
            webSocket.send("hi");  
            heartbeatTimer = setInterval(heartbeat, 20000);
        }

        function onMessage(message) {
            message = message.data;
            if (message == "") {
                console.log("Received heartbeat from server.");
                return;
            }
            console.log("Server: " + message);
        }

        function onClose() {
            alert("WebSocket connection closed")
            clearInterval(heartbeatTimer);
        }

        function heartbeat() {
            if (webSocket.readyState == webSocket.OPEN) {
                webSocket.send("");
                console.log("Sent heartbeat to server.");
            }
        }
    </script>
</body>
</html>
